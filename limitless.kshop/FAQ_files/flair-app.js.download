window.FlairApp={version:"2.0.2",config:{app:{},shop:{}},debug:window.location.search.includes("flairdebug"),init:function(t){(t||={}).app&&(this.config.app=t.app),t.shop&&(this.config.shop=t.shop),this.config.app.refresh_on_init&&(this.refreshProductBadges(),this.refreshBanners()),this.initBadgeVariantRefresh(),this.initBannerCountdown()},initBadgeVariantRefresh:function(){var e=this.config.app.badge_variant_refresh||{};if(e.enabled){var n=e.selector||".single-option-selector",r=e.parent_selector||'form[action="/cart/add"]',o=e.type,a=(this.debug&&console.log("[Flair] initBadgeVariantRefresh",o,r,n),function(){var t=e.delay||100;setTimeout(function(){this.refreshProductBadges()}.bind(this),t)}.bind(this)),t=document.querySelectorAll(r);0==t.size&&(this.debug&&console.log("[Flair] WARNING initBadgeVariantRefresh parent selector could not be found, using document",r),t=[document]);for(var i=0;i<t.length;i++){var s=t[i];this.debug&&console.log("[Flair] initBadgeVariantRefresh adding event listener",s),s.addEventListener(o,function(t){t.target.matches(n)&&(this.debug&&console.log("[Flair] variant refresh event detected",o,r,n),a())})}}},currentVariantId:function(){var t=document.querySelector("[name=id]");return t?t.value:window.location.search.replace(/.*variant=(\d+).*/,"$1")},getBanners:function(t){var e={};return e.layout=(t=t||{}).layout,e.sections="flair-banners",this.debug&&console.log("[Flair] getBanners",e),this.getSections(e).then(function(t){t=JSON.parse(t)["flair-banners"];return this.debug&&console.log("[Flair] getBanners result",t),t}.bind(this))},getProductBadges:function(t){if((t=t||{}).url)return this.getProductBadgesByUrl(t);var e={};return t.ids?e.ids=t.ids:this.config.shop.product_id&&(e.ids=[this.config.shop.product_id]),e.layout=t.layout,e.sections="flair-product-badges",this.debug&&console.log("[Flair] getProductBadges",e),this.getSections(e).then(function(t){t=JSON.parse(t)["flair-product-badges"];return this.debug&&console.log("[Flair] getProductBadges result",t),t}.bind(this))},getProductBadgesByUrl:function(t){var e=(t=t||{}).url||window.location.href,n={section_id:t.section||"flair-product-badges"};return t.variant&&(n.variant=t.variant),e=this.buildUrl(e,n),this.getUrl(e)},getProductBadgesMulti:function(t){return this.getProductBadges(t)},getSections(t){t=t||{};var e=t.sections||"flair-product-badges,flair-banners",n=[],r=t.ids||[];0==r.length&&this.config.shop.product_id&&r.unshift(this.config.shop.product_id);for(var o=0;o<r.length;o++)n.push("id:"+r[o].toString());t.layout&&(t=t.layout,/\s/.test(t)&&(t='"'+t+'"'),n.push("_lay:"+t));t=this.currentVariantId(),this.config.shop.product_id&&t&&n.push("_var:"+this.config.shop.product_id.toString()+"|"+t.toString()),this.config.shop.collection_handle&&n.push("_col:"+this.config.shop.collection_handle),this.config.shop.page_type&&n.push("_pag:"+this.config.shop.page_type),t={q:n.join(" OR "),sections:e},e=this.buildUrl("/search",t);return this.getUrl(e)},insertBanners:function(t){for(var e=document.createElement("div"),n=(e.innerHTML=t,e.querySelectorAll("[data-flair-banner]")),r=0;r<n.length;r++){for(var o=n[r],a=o.dataset.layout||"",i="[data-flair-banner]",s=(""!=a&&(i+='[data-layout="'+(a=a.toString().replace(/"/g,""))+'"]'),document.querySelectorAll(i)),d=!1,l=0;l<s.length;l++){var u,c=s[l];a==(c.dataset.layout||"")&&(u=o.cloneNode(!0),c.parentNode.replaceChild(u,c),d=!0)}!d&&this.debug&&console.log("[Flair] WARNING insertBanners unable to find match, banners were not inserted, layout:",a)}},insertProductBadges:function(t){for(var e=document.createElement("div"),n=(e.innerHTML=t,e.querySelectorAll("[data-flair-product-badge]")),r=0;r<n.length;r++){for(var o=n[r],a=o.dataset.productId||0,i=o.dataset.layout||"",s='[data-flair-product-badge][data-product-id="'+a.toString()+'"]',d=(""!=i&&(s+='[data-layout="'+(i=i.toString().replace(/"/g,""))+'"]'),document.querySelectorAll(s)),l=!1,u=0;u<d.length;u++){var c,h=d[u];i==(h.dataset.layout||"")&&(c=o.cloneNode(!0),h.parentNode.replaceChild(c,h),l=!0)}!l&&this.debug&&console.log("[Flair] WARNING insertProductBadges unable to find match, badges were not inserted - product id, layout:",a,i)}},refreshBanners:function(){for(var t=document.querySelectorAll("[data-flair-banner]"),e={},n=0;n<t.length;n++)e[o=t[n].dataset.layout||""]=!0;for(var r=Object.keys(e),n=0;n<r.length;n++){var o=r[n];this.getBanners({layout:o}).then(function(t){this.insertBanners(t)}.bind(this))}},refreshProductBadges:function(){for(var t=document.querySelectorAll("[data-flair-product-badge]"),e={},n=0;n<t.length;n++){var r=t[n],o=r.dataset.layout||"",r=r.dataset.productId;r&&(e[o]=e[o]||[],-1==e[o].indexOf(r)&&e[o].push(r))}for(var a=Object.keys(e),n=0;n<a.length;n++){o=a[n];this.getProductBadges({ids:e[a[n]],layout:o}).then(function(t){this.insertProductBadges(t)}.bind(this))}},buildUrl:function(t,e){var n=t;if(e)for(var n=n.split("?")[0],r=Object.keys(e),o=0;o<r.length;o++){n+=0==o?"?":"&";var a=r[o];n+=a+"="+e[a]}return n},getUrl:function(t){return fetch(t).then(function(t){return t.ok?t.text():(console.log("[Flair] Error fetching url",t.status),"")}).then(function(t){return t}).catch(function(t){return console.log("[Flair] Error getting url",t),""})},initBannerCountdown:function(){var t;this.config.app.banner_countdown_enabled&&(t=function(){this.updateBannerCountdown(),setTimeout(function(){t()},1e3)}.bind(this))()},updateBannerCountdown:function(){var t=document.querySelectorAll(".flair-banner-countdown");function e(t){return t<10?"0"+t:t}for(var n=0;n<t.length;n++){var r,o,a,i=t[n],s=1e3*i.dataset.time-(new Date).getTime();0<s?(i.style.display="inline-flex",r=Math.floor(s/864e5),o=Math.floor(s%864e5/36e5),a=Math.floor(s%36e5/6e4),s=Math.floor(s%6e4/1e3),i.querySelector("[data-day]").innerText=e(r),i.querySelector("[data-hour]").innerText=e(o),i.querySelector("[data-minute]").innerText=e(a),i.querySelector("[data-second]").innerText=e(s),0==r&&i.querySelectorAll('[data-section="day"]').forEach(function(t){t.style.display="none"})):i.style.display="none"}}};